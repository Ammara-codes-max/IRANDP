<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>IRANDP Live Attack Map</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  html, body { margin:0; height:100%; background:#020617; }
  #map { width:100%; height:100%; }
</style>
</head>

<body>
<div id="map"></div>

<script>
var map = L.map('map').setView([20,0],2);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'IRANDP SOC GEO MAP'
}).addTo(map);

var markers = {};

function loadAttacks() {
  fetch('live_data.json?t=' + new Date().getTime())
    .then(r => r.json())
    .then(data => {

      Object.values(data).forEach(p => {

        if (!markers[p.ip]) {
          var m = L.circleMarker([p.lat,p.lon],{
            radius:8,
            color:'red',
            fillColor:'#ff0000',
            fillOpacity:0.8
          }).addTo(map).bindPopup(
            "<b>IP:</b> "+p.ip+"<br><b>Country:</b> "+p.country
          );

          markers[p.ip] = m;
        }
      });
    });
}

setInterval(loadAttacks, 1500);
</script>
</body>
</html>
